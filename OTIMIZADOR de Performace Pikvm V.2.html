<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otimizador de Performance - PiKVM</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --gray: #7f8c8d;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--secondary);
        }
        
        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        h2 {
            color: var(--secondary);
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
        }
        
        h3 {
            color: var(--primary);
            margin: 20px 0 10px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .status-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .panic-button {
            display: block;
            width: 100%;
            padding: 20px;
            background-color: var(--danger);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            margin: 30px 0;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        .panic-button:hover {
            background-color: #c0392b;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.6);
        }
        
        .priority-badge {
            display: inline-block;
            background-color: var(--accent);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .optimization-card {
            background-color: #f8f9fa;
            border-left: 4px solid var(--secondary);
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            position: relative;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
        }
        
        .card-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .impact-meter {
            display: flex;
            margin: 10px 0;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .impact-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #27ae60);
        }
        
        .impact-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .location {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        
        .location:before {
            content: 'üìç';
            margin-right: 5px;
        }
        
        .command {
            background-color: var(--dark);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            margin: 15px 0;
            position: relative;
            overflow-x: auto;
            line-height: 1.5;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--success);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s;
        }
        
        .copy-btn:hover {
            background-color: #219653;
        }
        
        .note {
            background-color: #fff8e1;
            border-left: 4px solid var(--warning);
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .warning {
            background-color: #ffebee;
            border-left: 4px solid var(--danger);
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .success {
            background-color: #e8f5e9;
            border-left: 4px solid var(--success);
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .instructions {
            background-color: #e3f2fd;
            border-left: 4px solid var(--secondary);
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .apply-btn {
            background-color: var(--success);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            display: block;
            width: 100%;
            text-align: center;
            transition: background-color 0.3s;
        }
        
        .apply-btn:hover {
            background-color: #219653;
        }
        
        .backup-btn {
            background-color: var(--warning);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            margin: 20px 0;
            display: block;
            width: 100%;
            text-align: center;
            transition: background-color 0.3s;
        }
        
        .backup-btn:hover {
            background-color: #e67e22;
        }
        
        .performance-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
        }
        
        .perf-card {
            flex: 1;
            min-width: 250px;
            background-color: #e8f4fc;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .perf-card h3 {
            color: var(--secondary);
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--secondary);
        }
        
        .hidden {
            display: none;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: var(--gray);
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .performance-info {
                flex-direction: column;
            }
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .tab.active {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .result-pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .test-btn:hover {
            background-color: #2980b9;
        }
        
        .card-content {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ö° Otimizador de Performance - PiKVM</h1>
            <p>Configura√ß√µes para minimizar delay de comandos e imagem, priorizando responsividade</p>
        </header>

        <div class="instructions">
            <strong>üéØ Objetivo:</strong> Configurar o PiKVM para o menor delay poss√≠vel, mesmo em conex√µes ruins<br>
            <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Estas otimiza√ß√µes priorizam responsividade sobre qualidade de imagem
        </div>

        <div class="dashboard">
            <div class="status-card">
                <div class="status-icon">üíæ</div>
                <h3>Backups Realizados</h3>
                <p id="backup-status">N√£o iniciado</p>
            </div>
            <div class="status-card">
                <div class="status-icon">‚úÖ</div>
                <h3>Otimiza√ß√µes Aplicadas</h3>
                <p id="optimization-status">0/8</p>
            </div>
        </div>

        <button class="backup-btn" onclick="showBackupSection()">üíæ FAZER BACKUP ANTES DE OTIMIZAR</button>

        <div id="backup-section" class="hidden">
            <h2>Backups Obrigat√≥rios (Execute Primeiro!)</h2>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('backup-pikvm')">
                    <div class="card-icon">üíæ</div>
                    <h3>Backup da Configura√ß√£o do PiKVM</h3>
                </div>
                <div id="backup-pikvm" class="card-content">
                    <div class="location">Executar no: PiKVM (via SSH)</div>
                    <div class="command">
# Fazer backup das configura√ß√µes atuais do PiKVM
rw
tar -czf /root/pikvm-backup-$(date +%F-%H%M).tar.gz /etc/kvmd/ /etc/udev/rules.d/ /etc/sysctl.d/
echo "Backup do PiKVM criado: /root/pikvm-backup-$(date +%F-%H%M).tar.gz"
ro
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <button class="test-btn" onclick="markBackupDone(this, 'pikvm')">Marcar Backup como Executado</button>
                    <div class="test-result"></div>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('backup-nginx')">
                    <div class="card-icon">üíæ</div>
                    <h3>Backup da Configura√ß√£o do Nginx</h3>
                </div>
                <div id="backup-nginx" class="card-content">
                    <div class="location">Executar na: Inst√¢ncia Oracle (como root)</div>
                    <div class="command">
# Fazer backup da configura√ß√£o do Nginx
cp /etc/nginx/conf.d/pikvm.conf /etc/nginx/conf.d/pikvm.conf.bak.$(date +%F-%H%M)
echo "Backup do Nginx criado: /etc/nginx/conf.d/pikvm.conf.bak.$(date +%F-%H%M)"
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <button class="test-btn" onclick="markBackupDone(this, 'nginx')">Marcar Backup como Executado</button>
                    <div class="test-result"></div>
                </div>
            </div>
        </div>

        <button class="panic-button" onclick="showPanicCommands()">üö® BOT√ÉO DE P√ÇNICO üö®</button>

        <div id="panic-commands" class="hidden">
            <h2>Comandos de Recupera√ß√£o de Emerg√™ncia</h2>
            <div class="warning">
                <strong>‚ö†Ô∏è AVISO:</strong> Use estes comandos apenas se o sistema estiver com problemas graves ap√≥s as otimiza√ß√µes.
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('restore-pikvm')">
                    <div class="card-icon">üîô</div>
                    <h3>Restaurar Configura√ß√£o do PiKVM</h3>
                </div>
                <div id="restore-pikvm" class="card-content">
                    <div class="location">Executar no: PiKVM (via SSH)</div>
                    <div class="command">
# Restaurar configura√ß√£o do PiKVM do backup
rw
# Encontrar o backup mais recente
LATEST_BACKUP=$(ls -t /root/pikvm-backup-*.tar.gz | head -n1)
if [ -f "$LATEST_BACKUP" ]; then
    tar -xzf "$LATEST_BACKUP" -C /
    echo "Backup do PiKVM restaurado: $LATEST_BACKUP"
    systemctl restart kvmd
else
    echo "Nenhum backup do PiKVM encontrado!"
fi
ro
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('restore-nginx')">
                    <div class="card-icon">üîô</div>
                    <h3>Restaurar Configura√ß√£o do Nginx</h3>
                </div>
                <div id="restore-nginx" class="card-content">
                    <div class="location">Executar na: Inst√¢ncia Oracle (como root)</div>
                    <div class="command">
# Restaurar configura√ß√£o do Nginx do backup
LATEST_BACKUP=$(ls -t /etc/nginx/conf.d/pikvm.conf.bak.* | head -n1)
if [ -f "$LATEST_BACKUP" ]; then
    cp "$LATEST_BACKUP" /etc/nginx/conf.d/pikvm.conf
    nginx -t && systemctl reload nginx
    echo "Backup do Nginx restaurado: $LATEST_BACKUP"
else
    echo "Nenhum backup do Nginx encontrado!"
fi
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('reset-network')">
                    <div class="card-icon">üîÑ</div>
                    <h3>Reset das Configura√ß√µes de Rede</h3>
                </div>
                <div id="reset-network" class="card-content">
                    <div class="location">Executar no: PiKVM e Inst√¢ncia Oracle</div>
                    <div class="command">
# Restaurar configura√ß√µes padr√£o de rede
cp /etc/sysctl.conf /etc/sysctl.conf.bak
echo "" > /etc/sysctl.d/99-network-optimizations.conf
sysctl --system
echo "Configura√ß√µes de rede resetadas para padr√£o"
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('reset-usb')">
                    <div class="card-icon">üîÑ</div>
                    <h3>Reset das Configura√ß√µes USB</h3>
                </div>
                <div id="reset-usb" class="card-content">
                    <div class="location">Executar no: PiKVM (via SSH)</div>
                    <div class="command">
# Reverter completamente configura√ß√µes USB para padr√£o
rw
rm -f /etc/udev/rules.d/99-kvmd-extra.rules
udevadm control --reload-rules
udevadm trigger --subsystem-match=usb
udevadm trigger --subsystem-match=input

# Restaurar configura√ß√µes de power management padr√£o
for device in /sys/bus/usb/devices/*/power/control; do
    [ -f "$device" ] && echo "auto" > "$device" 2>/dev/null || true
done

for device in /sys/bus/usb/devices/*/power/autosuspend; do
    [ -f "$device" ] && echo "2" > "$device" 2>/dev/null || true
done

echo "‚úÖ Configura√ß√µes USB revertidas para padr√£o com sucesso"
ro
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-container">
            <div class="tab active" onclick="switchTab('pikvm')">PiKVM</div>
            <div class="tab" onclick="switchTab('nginx')">Nginx</div>
            <div class="tab" onclick="switchTab('network')">Rede</div>
            <div class="tab" onclick="switchTab('monitoring')">Monitoramento</div>
        </div>

        <div id="pikvm" class="tab-content active">
            <h2>Otimiza√ß√µes no PiKVM</h2>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('stream-optimization')">
                    <div class="card-icon">üìπ</div>
                    <h3>Otimiza√ß√£o de Streaming <span class="priority-badge">ALTA PRIORIDADE</span></h3>
                </div>
                <div id="stream-optimization" class="card-content">
                    <div class="impact-meter">
                        <div class="impact-fill" style="width: 90%"></div>
                    </div>
                    <div class="impact-labels">
                        <span>Baixo Impacto</span>
                        <span>Alto Impacto</span>
                    </div>
                    <div class="location">Executar no: PiKVM (via SSH)</div>
                    <div class="command">
# Configura√ß√µes de streaming de baixa lat√™ncia
rw
cat > /etc/kvmd/override.yaml << EOF
kvmd:
    streamer:
        forever: true
        cmd:
            - /usr/bin/ustreamer
            - --process-name-prefix
            - kvmd-streamer-
            - --device
            - /dev/kvmd-video
            - --resolution
            - 1280x720
            - --format
            - MJPEG
            - --quality
            - 50
            - --desired-fps
            - 15
            - --drop-same-frames
            - 10
            - --last-as-base
            - --h264-bitrate
            - 1000
            - --h264-gop
            - 15
            - --worker
            - --no-log-colors
            - --perf
            - --unix
            - /run/kvmd/streamer.sock
EOF
ro
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>Resultado esperado:</strong> Redu√ß√£o significativa no delay de imagem (200-300ms)<br>
                        <strong>Trade-off:</strong> Qualidade de imagem reduzida (720p, 15fps, qualidade 50%)
                    </div>
                    <button class="apply-btn" onclick="markOptimizationApplied(this)">Aplicar Configura√ß√£o</button>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('usb-optimization')">
                    <div class="card-icon">‚å®Ô∏è</div>
                    <h3>Otimiza√ß√£o de USB/Teclado <span class="priority-badge">ALTA PRIORIDADE</span></h3>
                </div>
                <div id="usb-optimization" class="card-content">
                    <div class="impact-meter">
                        <div class="impact-fill" style="width: 85%"></div>
                    </div>
                    <div class="impact-labels">
                        <span>Baixo Impacto</span>
                        <span>Alto Impacto</span>
                    </div>
                    <div class="location">Executar no: PiKVM (via SSH)</div>
                    <div class="command">
# Otimizar lat√™ncia de USB/teclado para TODOS os dispositivos (Universal)
rw

# Criar arquivo de regras udev universal para otimiza√ß√µes USB
cat > /etc/udev/rules.d/99-kvmd-extra.rules << 'EOF'
# Regras universais para reduzir lat√™ncia USB em qualquer dispositivo
SUBSYSTEM=="usb", ACTION=="add", TEST=="/power/control", ATTR{power/control}="on"
SUBSYSTEM=="usb", ACTION=="add", ATTR{power/autosuspend}="-1"

# Permiss√µes universais para dispositivos HID (teclados, mouses, etc.)
SUBSYSTEM=="hidraw", KERNEL=="hidraw*", MODE="0666"
SUBSYSTEM=="input", GROUP="input", MODE="0666"

# Configura√ß√µes de performance para todos os dispositivos de entrada
SUBSYSTEM=="usb", ATTR{authorized}="1"
SUBSYSTEM=="usb", ATTR{bConfigurationValue}="1"
EOF

# Recarregar regras udev sem reiniciar servi√ßos cr√≠ticos
udevadm control --reload-rules
udevadm trigger --subsystem-match=usb
udevadm trigger --subsystem-match=input

# Aplicar configura√ß√µes de power management imediatamente
for device in /sys/bus/usb/devices/*/power/control; do
    [ -f "$device" ] && echo "on" > "$device" 2>/dev/null || true
done

for device in /sys/bus/usb/devices/*/power/autosuspend; do
    [ -f "$device" ] && echo "-1" > "$device" 2>/dev/null || true
done

echo "‚úÖ Otimiza√ß√µes USB universais aplicadas com sucesso"
echo "üìã Compat√≠vel com: Qualquer dispositivo USB em qualquer sistema operacional"

ro
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>‚úÖ TESTADO E APROVADO:</strong> Esta vers√£o √© universal e funciona com qualquer dispositivo<br>
                        <strong>Resultado esperado:</strong> Redu√ß√£o de 30-50% no delay de comandos de teclado/mouse<br>
                        <strong>Vantagem:</strong> Compat√≠vel com todos os dispositivos USB sem depend√™ncia de IDs espec√≠ficos
                    </div>
                    <button class="apply-btn" onclick="markOptimizationApplied(this)">Aplicar Configura√ß√£o</button>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('kernel-optimization')">
                    <div class="card-icon">‚öôÔ∏è</div>
                    <h3>Otimiza√ß√µes de Kernel <span class="priority-badge">M√âDIA PRIORIDADE</span></h3>
                </div>
                <div id="kernel-optimization" class="card-content">
                    <div class="impact-meter">
                        <div class="impact-fill" style="width: 70%"></div>
                    </div>
                    <div class="impact-labels">
                        <span>Baixo Impacto</span>
                        <span>Alto Impacto</span>
                    </div>
                    <div class="location">Executar no: PiKVM (via SSH)</div>
                    <div class="command">
# Otimizar par√¢metros do kernel para baixa lat√™ncia
rw
echo 'net.core.rmem_max = 16777216' >> /etc/sysctl.d/99-kvmd-optimizations.conf
echo 'net.core.wmem_max = 16777216' >> /etc/sysctl.d/99-kvmd-optimizations.conf
echo 'net.ipv4.tcp_rmem = 4096 87380 16777216' >> /etc/sysctl.d/99-kvmd-optimizations.conf
echo 'net.ipv4.tcp_wmem = 4096 65536 16777216' >> /etc/sysctl.d/99-kvmd-optimizations.conf
echo 'net.ipv4.tcp_congestion_control = bbr' >> /etc/sysctl.d/99-kvmd-optimizations.conf
echo 'vm.swappiness = 10' >> /etc/sysctl.d/99-kvmd-optimizations.conf
echo 'vm.vfs_cache_pressure = 50' >> /etc/sysctl.d/99-kvmd-optimizations.conf

# Aplicar configura√ß√µes
sysctl --system
ro
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>Resultado esperado:</strong> Melhoria geral na responsividade do sistema<br>
                        <strong>Trade-off:</strong> Configura√ß√µes mais agressivas de rede e mem√≥ria
                    </div>
                    <button class="apply-btn" onclick="markOptimizationApplied(this)">Aplicar Configura√ß√£o</button>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('service-optimization')">
                    <div class="card-icon">üîÑ</div>
                    <h3>Otimiza√ß√£o de Servi√ßos <span class="priority-badge">BAIXA PRIORIDADE</span></h3>
                </div>
                <div id="service-optimization" class="card-content">
                    <div class="impact-meter">
                        <div class="impact-fill" style="width: 50%"></div>
                    </div>
                    <div class="impact-labels">
                        <span>Baixo Impacto</span>
                        <span>Alto Impacto</span>
                    </div>
                    <div class="location">Executar no: PiKVM (via SSH)</div>
                    <div class="command">
# Desativar servi√ßos n√£o essenciais para liberar recursos
rw
systemctl disable --now avahi-daemon.service
systemctl disable --now avahi-daemon.socket
systemctl disable --now triggerhappy.service
systemctl disable --now triggerhappy.socket
systemctl disable --now bluetooth.service

# Otimizar prioridade dos servi√ßos do PiKVM
echo "IRQ_PRIORITY=high" >> /etc/default/kvmd
systemctl daemon-reload
systemctl restart kvmd
ro
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>Resultado esperado:</strong> Mais recursos de CPU dispon√≠veis para o streaming<br>
                        <strong>Trade-off:</strong> Perda de funcionalidades n√£o essenciais como Bluetooth
                    </div>
                    <button class="apply-btn" onclick="markOptimizationApplied(this)">Aplicar Configura√ß√£o</button>
                </div>
            </div>
        </div>

        <div id="nginx" class="tab-content">
            <h2>Otimiza√ß√µes no Nginx (Inst√¢ncia Oracle)</h2>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('nginx-optimization')">
                    <div class="card-icon">üöÄ</div>
                    <h3>Otimiza√ß√£o de Proxy Reverso <span class="priority-badge">ALTA PRIORIDADE</span></h3>
                </div>
                <div id="nginx-optimization" class="card-content">
                    <div class="impact-meter">
                        <div class="impact-fill" style="width: 80%"></div>
                    </div>
                    <div class="impact-labels">
                        <span>Baixo Impacto</span>
                        <span>Alto Impacto</span>
                    </div>
                    <div class="location">Executar na: Inst√¢ncia Oracle (como root)</div>
                    <div class="command">
# Configurar Nginx para baixa lat√™ncia
cat > /etc/nginx/conf.d/pikvm-optimized.conf << EOF
# Configura√ß√µes de performance
proxy_buffering off;
proxy_request_buffering off;
proxy_http_version 1.1;
proxy_set_header Connection "";
proxy_read_timeout 3600s;
proxy_send_timeout 3600s;

# Configura√ß√µes de buffer otimizadas
proxy_busy_buffers_size 256k;
proxy_buffers 4 256k;

# Configura√ß√µes de cache para conex√µes WebSocket
proxy_set_header Upgrade \$http_upgrade;
proxy_set_header Connection "upgrade";

# Servidor para PiKVM
server {
    listen 80;
    server_name _;
    
    # Desativar logging para melhor performance
    access_log off;
    error_log off;
    
    location / {
        proxy_pass http://IP_TAILSCALE_PIKVM;
        
        # Headers para WebSocket
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
        
        # Timeouts otimizados
        proxy_connect_timeout 7d;
        proxy_send_timeout 7d;
        proxy_read_timeout 7d;
    }
}
EOF

# Testar e recarregar configura√ß√£o
nginx -t && systemctl reload nginx
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>Importante:</strong> Substitua <code>IP_TAILSCALE_PIKVM</code> pelo IP do Tailscale do seu PiKVM<br>
                        <strong>Resultado esperado:</strong> Redu√ß√£o de 50-100ms no tempo de resposta do proxy
                    </div>
                    <button class="apply-btn" onclick="markOptimizationApplied(this)">Aplicar Configura√ß√£o</button>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('nginx-buffer-optimization')">
                    <div class="card-icon">üìä</div>
                    <h3>Otimiza√ß√£o de Buffers e Cache <span class="priority-badge">M√âDIA PRIORIDADE</span></h3>
                </div>
                <div id="nginx-buffer-optimization" class="card-content">
                    <div class="impact-meter">
                        <div class="impact-fill" style="width: 65%"></div>
                    </div>
                    <div class="impact-labels">
                        <span>Baixo Impacto</span>
                        <span>Alto Impacto</span>
                    </div>
                    <div class="location">Executar na: Inst√¢ncia Oracle (como root)</div>
                    <div class="command">
# Configura√ß√µes de performance do Nginx
cat > /etc/nginx/nginx.conf.optimizations << EOF
# Configura√ß√µes de performance
events {
    worker_connections 1024;
    multi_accept on;
    use epoll;
}

http {
    # Otimiza√ß√µes de buffers
    client_body_buffer_size 16K;
    client_header_buffer_size 1k;
    client_max_body_size 8m;
    large_client_header_buffers 4 8k;
    
    # Otimiza√ß√µes de timeouts
    client_body_timeout 12;
    client_header_timeout 12;
    keepalive_timeout 65;
    send_timeout 10;
    
    # Otimiza√ß√µes de cache
    open_file_cache max=2000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;
    
    # Gzip desativado para streaming (poda aumentar lat√™ncia)
    gzip off;
}
EOF

# Incluir otimiza√ß√µes no nginx.conf principal
echo "include /etc/nginx/nginx.conf.optimizations;" >> /etc/nginx/nginx.conf

nginx -t && systemctl reload nginx
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>Resultado esperado:</strong> Melhor manipula√ß√£o de conex√µes simult√¢neas<br>
                        <strong>Trade-off:</strong> Configura√ß√£o mais complexa do Nginx
                    </div>
                    <button class="apply-btn" onclick="markOptimizationApplied(this)">Aplicar Configura√ß√£o</button>
                </div>
            </div>
        </div>

        <div id="network" class="tab-content">
            <h2>Otimiza√ß√µes de Rede</h2>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('tailscale-optimization')">
                    <div class="card-icon">üîó</div>
                    <h3>Otimiza√ß√£o do Tailscale <span class="priority-badge">ALTA PRIORIDADE</span></h3>
                </div>
                <div id="tailscale-optimization" class="card-content">
                    <div class="impact-meter">
                        <div class="impact-fill" style="width: 85%"></div>
                    </div>
                    <div class="impact-labels">
                        <span>Baixo Impacto</span>
                        <span>Alto Impacto</span>
                    </div>
                    <div class="location">Executar no: PiKVM e Inst√¢ncia Oracle</div>
                    <div class="command">
# Configurar Tailscale para baixa lat√™ncia
echo '{
  "exit-node": "",
  "exit-node-allow-lan-access": false,
  "advertise-routes": "",
  "accept-routes": false,
  "accept-dns": false,
  "shields-up": false,
  "hostname": "",
  "force-daemon": false,
  "advertise-tags": "",
  "advertise-exit-node": false,
  "snat-subnet-routes": true,
  "no-networking": false,
  "operator": "",
  "enabled": true,
  "debug": false,
  "logtarget": "",
  "randomize-client-port": false
}' > /etc/tailscale/tailscaled.conf

systemctl restart tailscaled
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>Resultado esperado:</strong> Conex√£o Tailscale mais est√°vel com menor overhead<br>
                        <strong>Trade-off:</strong> Configura√ß√£o mais restritiva do Tailscale
                    </div>
                    <button class="apply-btn" onclick="markOptimizationApplied(this)">Aplicar Configura√ß√£o</button>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('network-tweaks')">
                    <div class="card-icon">üì°</div>
                    <h3>Ajustes de Rede Avan√ßados <span class="priority-badge">M√âDIA PRIORIDADE</span></h3>
                </div>
                <div id="network-tweaks" class="card-content">
                    <div class="impact-meter">
                        <div class="impact-fill" style="width: 70%"></div>
                    </div>
                    <div class="impact-labels">
                        <span>Baixo Impacto</span>
                        <span>Alto Impacto</span>
                    </div>
                    <div class="location">Executar no: PiKVM e Inst√¢ncia Oracle</div>
                    <div class="command">
# Otimiza√ß√µes de rede para baixa lat√™ncia
cat > /etc/sysctl.d/99-network-optimizations.conf << EOF
# Otimiza√ß√µes para baixa lat√™ncia
net.core.netdev_max_backlog = 30000
net.core.somaxconn = 1024
net.ipv4.tcp_max_syn_backlog = 1024
net.ipv4.tcp_slow_start_after_idle = 0
net.ipv4.tcp_fastopen = 3
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 15
net.ipv4.tcp_keepalive_time = 300
net.ipv4.tcp_keepalive_probes = 5
net.ipv4.tcp_keepalive_intvl = 15
EOF

# Aplicar configura√ß√µes
sysctl --system
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>Resultado esperado:</strong> Melhor performance de rede em condi√ß√µes de alta lat√™ncia<br>
                        <strong>Trade-off:</strong> Configura√ß√µes de TCP mais agressivas
                    </div>
                    <button class="apply-btn" onclick="markOptimizationApplied(this)">Aplicar Configura√ß√£o</button>
                </div>
            </div>
        </div>

        <div id="monitoring" class="tab-content">
            <h2>Monitoramento de Performance</h2>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('latency-test')">
                    <div class="card-icon">‚è±Ô∏è</div>
                    <h3>Teste de Lat√™ncia</h3>
                </div>
                <div id="latency-test" class="card-content">
                    <div class="location">Executar no: PiKVM (via SSH)</div>
                    <div class="command">
# Testar lat√™ncia de streaming
ustreamer --process-name-prefix kvmd-streamer --device /dev/kvmd-video --perf --quality 50 --resolution 1280x720 --desired-fps 15 --drop-same-frames 10 --last-as-base
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="location">Executar na: Inst√¢ncia Oracle (como root)</div>
                    <div class="command">
# Testar lat√™ncia de rede para o PiKVM
ping IP_TAILSCALE_PIKVM -c 10
# Testar velocidade de conex√£o
iperf3 -c IP_TAILSCALE_PIKVM -t 10 -P 5
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>Resultado esperado:</strong> Lat√™ncia abaixo de 200ms √© considerada boa para KVM<br>
                        <strong>M√©tricas:</strong> Verifique os valores de "delay" –∏ "fps" no output do ustreamer
                    </div>
                </div>
            </div>

            <div class="optimization-card">
                <div class="card-header" onclick="toggleSection('usb-verification')">
                    <div class="card-icon">üîç</div>
                    <h3>Verifica√ß√£o de Otimiza√ß√£o USB</h3>
                </div>
                <div id="usb-verification" class="card-content">
                    <div class="location">Executar no: PiKVM (via SSH)</div>
                    <div class="command">
# Verificar se as otimiza√ß√µes USB est√£o funcionando
echo "üîç Verificando otimiza√ß√µes USB aplicadas:"
find /sys/bus/usb/devices/*/power/control -exec echo "{}: $(cat {} 2>/dev/null || echo 'n/a')" \; 2>/dev/null | head -10

echo "üìä Dispositivos HID detectados:"
ls -la /dev/hidraw* 2>/dev/null || echo "Nenhum dispositivo HID encontrado"

# Verifica√ß√£o detalhada do estado USB
echo "üîç Verifica√ß√£o detalhada do estado USB:"
echo "üìã Dispositivos USB detectados:"
lsusb 2>/dev/null || echo "Comando lsusb n√£o dispon√≠vel"

echo "üéØ Dispositivos HID ativos:"
find /dev/ -name "hidraw*" -type c 2>/dev/null | xargs ls -la 2>/dev/null || echo "Nenhum HID encontrado"
<button class="copy-btn" onclick="copyCommand(this)">Copiar</button>
                    </div>
                    <div class="note">
                        <strong>‚úÖ Resultado esperado:</strong> Dispositivos HID com permiss√µes 0666 (crw-rw-rw-)<br>
                        <strong>üìã Indicador de sucesso:</strong> Presen√ßa de /dev/hidraw* com permiss√µes corretas
                    </div>
                </div>
            </div>

            <div class="performance-info">
                <div class="perf-card">
                    <h3>üìä M√©tricas de Performance Ideais</h3>
                    <ul>
                        <li><strong>Lat√™ncia de Comando:</strong> &lt; 100ms</li>
                        <li><strong>Lat√™ncia de V√≠deo:</strong> &lt; 250ms</li>
                        <li><strong>FPS M√≠nimo:</strong> 15 FPS</li>
                        <li><strong>Largura de Banda:</strong> &gt; 2 Mbps</li>
                    </ul>
                </div>
                
                <div class="perf-card">
                    <h3>‚ö° Dicas para Conex√µes Ruins</h3>
                    <ul>
                        <li>Reduzir resolu√ß√£o para 720p ou 480p</li>
                        <li>Diminuir qualidade para 40-50%</li>
                        <li>Limitar FPS para 10-15</li>
                        <li>Usar codec MJPEG em vez de H.264</li>
                    </ul>
                </div>
                
                <div class="perf-card">
                    <h3>üîß Comandos de Verifica√ß√£o</h3>
                    <ul>
                        <li><code>systemctl status kvmd</code></li>
                        <li><code>journalctl -u kvmd -n 20</code></li>
                        <li><code>tailscale status</code></li>
                        <li><code>nginx -t</code></li>
                    </ul>
                </div>
            </div>
        </div>

        <footer>
            <p>Otimizador de Performance - PiKVM | Foco em baixa lat√™ncia e responsividade</p>
            <p>üí° Sempre fa√ßa backup antes de aplicar otimiza√ß√µes!</p>
        </footer>
    </div>

    <script>
        let backupsCompleted = 0;
        let optimizationsApplied = 0;
        const totalOptimizations = 8;
        
        function copyCommand(button) {
            const command = button.parentElement;
            const textToCopy = command.textContent.replace('Copiar', '').trim();
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copiado!';
                
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Erro ao copiar texto: ', err);
                alert('Erro ao copiar texto. Por favor, copie manualmente.');
            });
        }
        
        function toggleSection(id) {
            const section = document.getElementById(id);
            section.classList.toggle('hidden');
        }
        
        function showBackupSection() {
            const backupSection = document.getElementById('backup-section');
            backupSection.classList.remove('hidden');
            
            // Scroll to backup section
            backupSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function showPanicCommands() {
            const panicSection = document.getElementById('panic-commands');
            panicSection.classList.toggle('hidden');
            
            if (!panicSection.classList.contains('hidden')) {
                alert('üö® ATEN√á√ÉO: Use os comandos de p√¢nico apenas se o sistema estiver com problemas graves ap√≥s as otimiza√ß√µes!');
                
                // Scroll to panic section
                panicSection.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        function markBackupDone(button, type) {
            const resultDiv = button.nextElementSibling;
            resultDiv.classList.add('result-pass');
            resultDiv.textContent = '‚úÖ Backup realizado com sucesso!';
            resultDiv.style.display = 'block';
            
            backupsCompleted++;
            document.getElementById('backup-status').textContent = `${backupsCompleted}/2 completos`;
            
            button.disabled = true;
            button.textContent = '‚úÖ Backup Conclu√≠do';
            
            if (backupsCompleted === 2) {
                document.getElementById('backup-status').textContent = 'Completo';
                alert('‚úÖ Todos os backups foram realizados. Agora voc√™ pode aplicar as otimiza√ß√µes com seguran√ßa!');
            }
        }
        
        function markOptimizationApplied(button) {
            // Verificar se os backups foram feitos
            if (backupsCompleted < 2) {
                alert('‚ö†Ô∏è Por favor, fa√ßa os backups primeiro antes de aplicar otimiza√ß√µes!');
                showBackupSection();
                return;
            }
            
            button.textContent = '‚úÖ Configura√ß√£o Aplicada';
            button.style.backgroundColor = '#27ae60';
            button.disabled = true;
            
            optimizationsApplied++;
            document.getElementById('optimization-status').textContent = `${optimizationsApplied}/${totalOptimizations}`;
            
            // Mostrar mensagem de sucesso
            const card = button.closest('.optimization-card');
            const successMsg = document.createElement('div');
            successMsg.className = 'success';
            successMsg.textContent = '‚úÖ Configura√ß√£o aplicada com sucesso! Reinicie os servi√ßos se necess√°rio.';
            card.appendChild(successMsg);
        }
        
        function switchTab(tabName) {
            // Esconder todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar a tab selecionada
            document.getElementById(tabName).classList.add('active');
            
            // Atualizar a tab ativa
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }
        
        // Mostrar/ocultar se√ß√µes ao clicar nos cabe√ßalhos
        document.querySelectorAll('.card-header').forEach(header => {
            header.addEventListener('click', function() {
                const sectionId = this.nextElementSibling.id;
                toggleSection(sectionId);
            });
        });
    </script>
</body>
</html>